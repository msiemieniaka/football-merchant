{{/*
Generic Service Template - Creates services for all enabled components
*/}}

{{- /* Frontend Service */ -}}
{{- if .Values.frontend.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.frontend.name | default "frontend" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: frontend
spec:
  type: {{ .Values.frontend.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.frontend.service.port }}
      targetPort: {{ .Values.frontend.port }}
      protocol: TCP
      name: http
      {{- if and (eq .Values.frontend.service.type "NodePort") .Values.frontend.service.nodePort }}
      nodePort: {{ .Values.frontend.service.nodePort }}
      {{- end }}
  selector:
    app: {{ .Values.frontend.name | default "frontend" }}
---
{{- end }}

{{- /* Backend Service */ -}}
{{- if .Values.backend.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.backend.name | default "backend" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: backend
spec:
  type: {{ .Values.backend.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.backend.service.port }}
      targetPort: {{ .Values.backend.port }}
      protocol: TCP
      name: http
  selector:
    app: {{ .Values.backend.name | default "backend" }}
---
{{- end }}

{{- /* PostgreSQL Primary Service */ -}}
{{- if and .Values.postgres .Values.postgres.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.postgres.primary.name | default "postgres-primary" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: postgres-primary
spec:
  type: {{ .Values.postgres.primary.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.postgres.primary.service.port | default 5432 }}
      targetPort: {{ .Values.postgres.primary.port | default 5432 }}
      protocol: TCP
      name: postgres
  selector:
    app: {{ .Values.postgres.primary.name | default "postgres-primary" }}
    role: primary
---
{{- end }}

{{- /* PostgreSQL Replica Service */ -}}
{{- if and .Values.postgres .Values.postgres.enabled .Values.postgres.replica .Values.postgres.replica.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.postgres.replica.name | default "postgres-replica" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: postgres-replica
spec:
  type: {{ .Values.postgres.replica.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.postgres.replica.service.port | default 5432 }}
      targetPort: {{ .Values.postgres.replica.port | default 5432 }}
      protocol: TCP
      name: postgres
  selector:
    app: {{ .Values.postgres.replica.name | default "postgres-replica" }}
    role: replica
---
{{- end }}

{{- /* Ollama Service */ -}}
{{- if .Values.ollama.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.ollama.name | default "ollama" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: ollama
spec:
  type: {{ .Values.ollama.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.ollama.service.port }}
      targetPort: {{ .Values.ollama.port }}
      protocol: TCP
      name: http
  selector:
    app: {{ .Values.ollama.name | default "ollama" }}
---
{{- end }}

{{- /* PgAdmin Service */ -}}
{{- if .Values.pgadmin.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.pgadmin.name | default "pgadmin" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: pgadmin
spec:
  type: {{ .Values.pgadmin.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.pgadmin.service.port }}
      targetPort: {{ .Values.pgadmin.port }}
      protocol: TCP
      name: http
      {{- if and (eq .Values.pgadmin.service.type "NodePort") .Values.pgadmin.service.nodePort }}
      nodePort: {{ .Values.pgadmin.service.nodePort }}
      {{- end }}
  selector:
    app: {{ .Values.pgadmin.name | default "pgadmin" }}
---
{{- end }}

{{- /* Redis Service */ -}}
{{- if and .Values.redis .Values.redis.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.redis.name | default "redis" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: redis
spec:
  type: {{ .Values.redis.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.redis.service.port | default 6379 }}
      targetPort: {{ .Values.redis.port | default 6379 }}
      protocol: TCP
      name: redis
  selector:
    app: {{ .Values.redis.name | default "redis" }}
---
{{- end }}

{{- /* PgBouncer Service */ -}}
{{- if and .Values.pgbouncer .Values.pgbouncer.enabled }}
apiVersion: v1
kind: Service
metadata:
  name: {{ .Values.pgbouncer.name | default "pgbouncer" }}
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "football-ai.labels" . | nindent 4 }}
    app.kubernetes.io/component: pgbouncer
spec:
  type: {{ .Values.pgbouncer.service.type | default "ClusterIP" }}
  ports:
    - port: {{ .Values.pgbouncer.service.port | default 5432 }}
      targetPort: {{ .Values.pgbouncer.port | default 5432 }}
      protocol: TCP
      name: postgres
  selector:
    app: {{ .Values.pgbouncer.name | default "pgbouncer" }}
{{- end }}
